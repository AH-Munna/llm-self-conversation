// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

model Identity {
    id            String   @id @default(uuid())
    name          String
    avatar        String?
    bio           String   @db.Text
    modelProvider String   @default("openai")
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    roomParticipants RoomParticipant[]
    messages         Message[]
}

model Room {
    id        String   @id @default(uuid())
    name      String
    scenario  String   @db.Text
    isPublic  Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    participants RoomParticipant[]
    messages     Message[]
}

model RoomParticipant {
    id         String   @id @default(uuid())
    roomId     String
    identityId String
    joinedAt   DateTime @default(now())

    room     Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
    identity Identity @relation(fields: [identityId], references: [id], onDelete: Cascade)

    @@unique([roomId, identityId])
}

model Message {
    id      String @id @default(uuid())
    content String @db.Text
    role    String // "user" or "assistant"

    identityId String?
    roomId     String

    createdAt DateTime @default(now())

    identity Identity? @relation(fields: [identityId], references: [id], onDelete: SetNull)
    room     Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)
}
